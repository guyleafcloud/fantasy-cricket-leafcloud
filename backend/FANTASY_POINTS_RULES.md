# Fantasy Points Rules

## âœ… Updated Rules (Current)

### Batting Points

| Category | Points | Notes |
|----------|--------|-------|
| **Runs** | 1 per run | Base scoring |
| **Fifty** | +8 | Bonus for 50+ runs |
| **Century** | +16 | Bonus for 100+ runs |
| **Duck** | -2 | 0 runs with balls faced > 0 (capped at 0 total) |
| **~~Fours~~** | ~~0~~ | **REMOVED - No boundary bonus** |
| **~~Sixes~~** | ~~0~~ | **REMOVED - No boundary bonus** |

### Strike Rate Bonuses (NEW!)
**No minimum balls required**

| Strike Rate | Points | Description |
|-------------|--------|-------------|
| SR >= 150 | +10 | Excellent strike rate |
| SR >= 100 | +5 | Good strike rate |
| SR < 50 | -5 | Poor strike rate (penalty) |

**Example:**
- 85 runs off 46 balls = SR 184.8 â†’ **+10 points bonus**
- 45 runs off 100 balls = SR 45.0 â†’ **-5 points penalty**

---

### Bowling Points

| Category | Points | Notes |
|----------|--------|-------|
| **Wickets** | 12 per wicket | Main bowling points |
| **Maidens** | **25 per maiden** | **INCREASED from 4 to 25** |
| **5-Wicket Haul** | +8 | Bonus for 5+ wickets |

### Economy Rate Bonuses (NEW!)
**No minimum overs required**

| Economy Rate | Points | Description |
|--------------|--------|-------------|
| ER < 4.0 | +10 | Excellent economy |
| ER < 5.0 | +5 | Good economy |
| ER > 7.0 | -5 | Poor economy (penalty) |

**Example:**
- 2/18 in 6 overs = ER 3.0 â†’ **+10 points bonus**
- 1/40 in 5 overs = ER 8.0 â†’ **-5 points penalty**

---

### Fielding Points

| Category | Points |
|----------|--------|
| **Catch** | 4 |
| **Stumping** | 6 |
| **Run Out** | 6 |

---

### Tier Multipliers

Applied to final score:

| Tier | Multiplier | Grades |
|------|------------|--------|
| **Tier 1** | x1.2 | Topklasse, Hoofdklasse |
| **Tier 2** | x1.0 | Eerste Klasse, Tweede Klasse |
| **Tier 3** | x0.8 | Derde Klasse, Vierde Klasse |
| **Youth** | x0.6 | U13, U15, U17 |
| **Ladies** | x0.9 | Vrouwen competitions |
| **Social** | x0.4 | ZAMI, ZOMI |

---

## ğŸ“Š Example Calculations

### Example 1: Explosive Batting
**Performance:** 85 runs off 46 balls (10 fours, 4 sixes) - Tier 2

**Calculation:**
```
Runs:              85 points
Fifty bonus:       +8 points
Strike rate (184): +10 points (SR >= 150)
Boundary bonus:    0 points (REMOVED)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Subtotal:          103 points
Tier multiplier:   x1.0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL:             103 points
```

**Note:** Under old rules, this would have been:
- 85 + 10 + 8 + 8 = 111 points (8 points MORE with boundary bonuses)

---

### Example 2: Maiden Masterclass
**Performance:** 3/22 in 10 overs, 5 maidens - Tier 1

**Calculation:**
```
Wickets:           36 points (3 x 12)
Maidens:           125 points (5 x 25) â† HUGE!
Economy (2.2):     +10 points (ER < 4.0)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Subtotal:          171 points
Tier multiplier:   x1.2 (tier1)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL:             205 points
```

**Note:** Under old rules (maidens = 4 pts):
- 36 + 20 + 10 = 66 Ã— 1.2 = 79 points
- **NEW RULES: 126 points MORE!**

---

### Example 3: Century with Good SR
**Performance:** 105 runs off 84 balls (12 fours, 3 sixes) - Tier 1

**Calculation:**
```
Runs:              105 points
Century bonus:     +16 points
Strike rate (125): +5 points (SR >= 100)
Boundary bonus:    0 points (REMOVED)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Subtotal:          126 points
Tier multiplier:   x1.2
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL:             151 points
```

---

### Example 4: Slow Innings (Penalty)
**Performance:** 45 runs off 100 balls - Tier 2

**Calculation:**
```
Runs:              45 points
Strike rate (45):  -5 points (SR < 50)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Subtotal:          40 points
Tier multiplier:   x1.0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL:             40 points
```

---

## ğŸ”„ What Changed from Old Rules

### âŒ Removed
- **Fours bonus:** Was 1 point per four â†’ Now 0
- **Sixes bonus:** Was 2 points per six â†’ Now 0

### â¬†ï¸ Increased
- **Maidens:** 4 points â†’ **25 points** (6.25x increase!)

### âœ¨ Added
- **Strike rate bonuses/penalties** (no minimum balls)
- **Economy rate bonuses/penalties** (no minimum overs)

---

## ğŸ¯ Impact Summary

### Batting
- **Boundary hitters:** Slightly less rewarded (no 4s/6s bonus)
- **Fast scorers:** More rewarded (SR bonus)
- **Slow accumulation:** Penalized (SR penalty)

### Bowling
- **Economical bowlers:** Much more rewarded
- **Maiden overs:** **MASSIVELY rewarded** (25 pts each!)
- **Expensive bowlers:** Penalized

### Overall Philosophy
**New system rewards:**
- Aggressive, fast-scoring batting (high SR)
- Economical, tight bowling (low ER)
- Maidens are now EXTREMELY valuable!

**Penalties for:**
- Slow, defensive batting (low SR)
- Expensive bowling (high ER)

---

## ğŸ“ Notes

1. **No minimum requirements** for SR/ER bonuses
   - Even 1 ball faced â†’ SR calculation
   - Even 1 over bowled â†’ ER calculation

2. **Points capped at 0 minimum**
   - Can't go negative overall
   - But penalties can reduce total points

3. **Tier multiplier applied last**
   - All points calculated first
   - Then multiplied by tier

4. **Boundary runs still count**
   - Fours/sixes counted as runs (4 or 6 points)
   - Just no EXTRA bonus on top

---

---

## ğŸ­ Player Multipliers (League-Specific)

### Overview

Each player has a **dynamic multiplier** that adjusts their fantasy points based on relative performance. Crucially, **multipliers are league-specific** - the same player can have different multipliers in different leagues!

### How It Works

1. **Initial Multiplier** (League Confirmation)
   - When a league is confirmed, each roster player's current multiplier is captured
   - This becomes the starting point for that league
   - Range: 0.69 (star players) to 5.0 (weaker players)
   - Median: 1.0 (average players)

2. **Weekly Drift** (Every Monday 2 AM)
   - Multipliers adjust by 15% toward current season performance
   - Calculated **independently per league** based on league's roster
   - Formula: `new = old Ã— 0.85 + target Ã— 0.15`

3. **Final Fantasy Points**
   - `base_fantasy_points` = Points from rules above (batting + bowling + fielding)
   - `fantasy_points` = `base_fantasy_points Ã— league_multiplier`
   - Different leagues see different fantasy_points for the same performance!

### Multiplier Scale (Relative to League Median)

| Performance Level | Multiplier Range | Effect |
|------------------|------------------|--------|
| **Below median** (weaker) | 1.0 â†’ 5.0 | Points **multiplied** (easier to get points) |
| **At median** (average) | 1.0 | No change |
| **Above median** (stronger) | 1.0 â†’ 0.69 | Points **reduced** (harder to get points) |

### Why League-Specific?

Different leagues have different rosters with different performance distributions. A player who is "average" in League A might be "strong" in League B.

**Example:**

- **League A Roster:** Contains many high scorers â†’ median = 120 pts
- **League B Roster:** Contains fewer stars â†’ median = 80 pts
- **Player X Season Points:** 100 pts

In League A:
- Below median (100 < 120) â†’ multiplier = 1.2
- Base 50 pts â†’ 50 Ã— 1.2 = **60 fantasy points**

In League B:
- Above median (100 > 80) â†’ multiplier = 0.85
- Base 50 pts â†’ 50 Ã— 0.85 = **42.5 fantasy points**

Same performance, different fantasy points! This ensures fair competition within each league's context.

### Implementation

- `PlayerPerformance.base_fantasy_points` = Points before multiplier
- `PlayerPerformance.multiplier_applied` = League-specific multiplier used
- `PlayerPerformance.fantasy_points` = Final points (base Ã— multiplier)
- `League.multipliers_snapshot` = Current multiplier values for each roster player
- Updates weekly via Celery task: `adjust_multipliers_weekly()`

---

## âœ… Validation

All new rules tested and working:
- âœ… Boundary bonuses removed
- âœ… Maidens = 25 points
- âœ… Strike rate bonuses working
- âœ… Economy rate bonuses working
- âœ… No minimum balls/overs required
- âœ… All edge cases handled
- âœ… League-specific multipliers working independently
- âœ… Weekly drift task processes all active leagues

See: `test_new_points_rules.py` and `test_league_specific_multipliers.py` for comprehensive tests
